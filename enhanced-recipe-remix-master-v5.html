<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Recipe Remix Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('https://images.unsplash.com/photo-1519864600265-abb23847ef2c?auto=format&fit=crop&w=1500&q=80') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
        }

        .sidebar-header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .sidebar-header h2 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .sidebar-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-item, .dietary-option, .cuisine-option {
            display: block;
            width: 100%;
            padding: 10px 15px;
            margin: 5px 0;
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 0.95em;
        }

        .category-item:hover, .dietary-option:hover, .cuisine-option:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateX(5px);
        }

        .category-item.active, .dietary-option.active, .cuisine-option.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Category Button Styles with Background Images */
        .category-item {
            position: relative;
            overflow: hidden;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }

        .category-text {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            z-index: 2;
            position: relative;
        }

        .category-breakfast {
            background-image: url('https://images.unsplash.com/photo-1494859802809-d069c3b71a8a?auto=format&fit=crop&w=400&q=80');
        }

        .category-lunch {
            background-image: url('https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=400&q=80');
        }

        .category-dinner {
            background-image: url('https://images.unsplash.com/photo-1414235077428-338989a2e8c0?auto=format&fit=crop&w=400&q=80');
        }

        .category-desserts {
            background-image: url('https://images.unsplash.com/photo-1565958011703-44f9829ba187?auto=format&fit=crop&w=400&q=80');
        }

        .category-snacks {
            background-image: url('https://images.unsplash.com/photo-1513104890138-7c749659a591?auto=format&fit=crop&w=400&q=80');
        }

        .category-appetizers {
            background-image: url('https://images.unsplash.com/photo-1551218808-94e220e084d2?auto=format&fit=crop&w=400&q=80');
        }

        .category-soups {
            background-image: url('https://images.unsplash.com/photo-1547592166-23ac45744acd?auto=format&fit=crop&w=400&q=80');
        }

        .category-salads {
            background-image: url('https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=400&q=80');
        }

        .category-pasta {
            background-image: url('https://images.unsplash.com/photo-1551183053-bf91a1d81141?auto=format&fit=crop&w=400&q=80');
        }

        .category-seafood {
            background-image: url('https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?auto=format&fit=crop&w=400&q=80');
        }

        .category-vegetarian {
            background-image: url('https://images.unsplash.com/photo-1540420773420-3366772f4999?auto=format&fit=crop&w=400&q=80');
        }

        .category-quick {
            background-image: url('https://images.unsplash.com/photo-1495521821757-a1efb6729352?auto=format&fit=crop&w=400&q=80');
        }

        .category-item:hover {
            transform: translateX(5px) scale(1.02);
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .category-item.active {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        .category-item.active .category-text {
            background: rgba(102, 126, 234, 0.9);
        }

        /* Dietary Option Button Styles */
        .dietary-option {
            position: relative;
            overflow: hidden;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            margin: 5px 0;
        }

        .dietary-text {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            z-index: 2;
            position: relative;
            font-size: 0.9em;
        }

        .dietary-vegetarian {
            background-image: url('https://images.unsplash.com/photo-1540420773420-3366772f4999?auto=format&fit=crop&w=400&q=80');
        }

        .dietary-vegan {
            background-image: url('https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=400&q=80');
        }

        .dietary-gluten-free {
            background-image: url('https://images.unsplash.com/photo-1504674900240-9a9049b7d8ce?auto=format&fit=crop&w=400&q=80');
        }

        .dietary-dairy-free {
            background-image: url('https://images.unsplash.com/photo-1551218808-94e220e084d2?auto=format&fit=crop&w=400&q=80');
        }

        .dietary-low-carb {
            background-image: url('https://images.unsplash.com/photo-1513104890138-7c749659a591?auto=format&fit=crop&w=400&q=80');
        }

        .dietary-keto {
            background-image: url('https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?auto=format&fit=crop&w=400&q=80');
        }

        .dietary-paleo {
            background-image: url('https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&w=400&q=80');
        }

        .dietary-nut-free {
            background-image: url('https://images.unsplash.com/photo-1494859802809-d069c3b71a8a?auto=format&fit=crop&w=400&q=80');
        }

        /* Cuisine Option Button Styles */
        .cuisine-option {
            position: relative;
            overflow: hidden;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            margin: 5px 0;
        }

        .cuisine-text {
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            z-index: 2;
            position: relative;
            font-size: 0.9em;
        }

        .cuisine-italian {
            background-image: url('https://images.unsplash.com/photo-1621996346565-e3dbc353d2e5?auto=format&fit=crop&w=400&q=80');
        }

        .cuisine-mexican {
            background-image: url('https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?auto=format&fit=crop&w=400&q=80');
        }

        .cuisine-asian {
            background-image: url('https://images.unsplash.com/photo-1551218808-94e220e084d2?auto=format&fit=crop&w=400&q=80');
        }

        .cuisine-indian {
            background-image: url('https://images.unsplash.com/photo-1565557623262-b51c2513a641?auto=format&fit=crop&w=400&q=80');
        }

        .cuisine-mediterranean {
            background-image: url('https://images.unsplash.com/photo-1540420773420-3366772f4999?auto=format&fit=crop&w=400&q=80');
        }

        .cuisine-french {
            background-image: url('https://images.unsplash.com/photo-1414235077428-338989a2e8c0?auto=format&fit=crop&w=400&q=80');
        }

        .cuisine-thai {
            background-image: url('https://images.unsplash.com/photo-1565557623262-b51c2513a641?auto=format&fit=crop&w=400&q=80');
        }

        .cuisine-japanese {
            background-image: url('https://images.unsplash.com/photo-1551218808-94e220e084d2?auto=format&fit=crop&w=400&q=80');
        }

        .cuisine-greek {
            background-image: url('https://images.unsplash.com/photo-1540420773420-3366772f4999?auto=format&fit=crop&w=400&q=80');
        }

        .cuisine-chinese {
            background-image: url('https://images.unsplash.com/photo-1565557623262-b51c2513a641?auto=format&fit=crop&w=400&q=80');
        }

        .dietary-option:hover, .cuisine-option:hover {
            transform: translateX(5px) scale(1.02);
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .dietary-option.active, .cuisine-option.active {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }

        .dietary-option.active .dietary-text, .cuisine-option.active .cuisine-text {
            background: rgba(102, 126, 234, 0.9);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Animated Title Styles */
        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .dancing-title {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5em;
            font-weight: 700;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin: 0;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            0% { text-shadow: 2px 2px 4px rgba(0,0,0,0.5), 0 0 10px rgba(255,255,255,0.3); }
            100% { text-shadow: 2px 2px 4px rgba(0,0,0,0.5), 0 0 20px rgba(255,255,255,0.6); }
        }

        .animated-plate {
            position: relative;
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .plate {
            font-size: 4em;
            animation: spinPlate 8s linear infinite;
            position: relative;
            z-index: 2;
        }

        @keyframes spinPlate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .utensils {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }

        .fork, .knife {
            font-size: 2em;
            position: absolute;
            animation: rotateUtensils 6s linear infinite;
        }

        .fork {
            animation-delay: 0s;
        }

        .knife {
            animation-delay: 3s;
        }

        @keyframes rotateUtensils {
            0% { transform: rotate(0deg) translateX(30px) rotate(0deg); }
            100% { transform: rotate(360deg) translateX(30px) rotate(-360deg); }
        }

        .food-items {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
        }

        .food-item {
            position: absolute;
            font-size: 2.5em;
            opacity: 0;
            animation: showFood 10s linear infinite;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .food-item:nth-child(1) { animation-delay: 0s; }
        .food-item:nth-child(2) { animation-delay: 1s; }
        .food-item:nth-child(3) { animation-delay: 2s; }
        .food-item:nth-child(4) { animation-delay: 3s; }
        .food-item:nth-child(5) { animation-delay: 4s; }
        .food-item:nth-child(6) { animation-delay: 5s; }
        .food-item:nth-child(7) { animation-delay: 6s; }
        .food-item:nth-child(8) { animation-delay: 7s; }
        .food-item:nth-child(9) { animation-delay: 8s; }
        .food-item:nth-child(10) { animation-delay: 9s; }

        @keyframes showFood {
            0%, 8% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            10%, 18% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            20%, 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content-area {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }

        .btn-success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .recipe-display {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Lato', sans-serif;
            font-size: 14px;
            line-height: 1.6;
            max-height: 600px;
            overflow-y: auto;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .selected-category {
            background: #e8f5e8;
            border-left: 4px solid #2ecc71;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .selected-category h3 {
            color: #27ae60;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                margin-bottom: 20px;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }

        .action-bar {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100vw;
            background: rgba(255,255,255,0.95);
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 15px 0 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.08);
            z-index: 1000;
        }
        .action-btn {
            font-size: 1.1em;
            padding: 10px 22px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #333;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.07);
            transition: background 0.2s, transform 0.2s;
        }
        .action-btn:hover {
            background: linear-gradient(135deg, #fcb69f 0%, #ffecd2 100%);
            transform: translateY(-2px);
        }
        .modal {
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.4);
        }
        .modal.hidden { display: none; }
        .modal-content {
            background: #fff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            min-width: 320px;
            max-width: 90vw;
            position: relative;
        }
        .modal-content h2 { margin-bottom: 18px; }
        .modal-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .modal-content th, .modal-content td {
            border: 1px solid #eee;
            padding: 8px 12px;
            text-align: center;
        }
        .close {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 1.7em;
            color: #888;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>üçΩÔ∏è Recipe Master</h2>
            <p>Find your perfect recipe</p>
        </div>

        <!-- Categories Section -->
        <div class="sidebar-section">
            <h3>üìÇ Categories</h3>
            <button class="category-item category-breakfast" onclick="selectCategory('breakfast')">
                <span class="category-text">Breakfast</span>
            </button>
            <button class="category-item category-lunch" onclick="selectCategory('lunch')">
                <span class="category-text">Lunch</span>
            </button>
            <button class="category-item category-dinner" onclick="selectCategory('dinner')">
                <span class="category-text">Dinner</span>
            </button>
            <button class="category-item category-desserts" onclick="selectCategory('desserts')">
                <span class="category-text">Desserts</span>
            </button>
            <button class="category-item category-snacks" onclick="selectCategory('snacks')">
                <span class="category-text">Snacks</span>
            </button>
            <button class="category-item category-appetizers" onclick="selectCategory('appetizers')">
                <span class="category-text">Appetizers</span>
            </button>
            <button class="category-item category-soups" onclick="selectCategory('soups')">
                <span class="category-text">Soups</span>
            </button>
            <button class="category-item category-salads" onclick="selectCategory('salads')">
                <span class="category-text">Salads</span>
            </button>
            <button class="category-item category-pasta" onclick="selectCategory('pasta')">
                <span class="category-text">Pasta</span>
            </button>
            <button class="category-item category-seafood" onclick="selectCategory('seafood')">
                <span class="category-text">Seafood</span>
            </button>
            <button class="category-item category-vegetarian" onclick="selectCategory('vegetarian')">
                <span class="category-text">Vegetarian</span>
            </button>
            <button class="category-item category-quick" onclick="selectCategory('quick')">
                <span class="category-text">Quick & Easy</span>
            </button>
        </div>

        <!-- Dietary Restrictions Section -->
        <div class="sidebar-section">
            <h3>ü•ó Dietary Options</h3>
            <button class="dietary-option dietary-vegetarian" onclick="selectDietary('vegetarian')">
                <span class="dietary-text">Vegetarian</span>
            </button>
            <button class="dietary-option dietary-vegan" onclick="selectDietary('vegan')">
                <span class="dietary-text">Vegan</span>
            </button>
            <button class="dietary-option dietary-gluten-free" onclick="selectDietary('gluten-free')">
                <span class="dietary-text">Gluten-Free</span>
            </button>
            <button class="dietary-option dietary-dairy-free" onclick="selectDietary('dairy-free')">
                <span class="dietary-text">Dairy-Free</span>
            </button>
            <button class="dietary-option dietary-low-carb" onclick="selectDietary('low-carb')">
                <span class="dietary-text">Low-Carb</span>
            </button>
            <button class="dietary-option dietary-keto" onclick="selectDietary('keto')">
                <span class="dietary-text">Keto</span>
            </button>
            <button class="dietary-option dietary-paleo" onclick="selectDietary('paleo')">
                <span class="dietary-text">Paleo</span>
            </button>
            <button class="dietary-option dietary-nut-free" onclick="selectDietary('nut-free')">
                <span class="dietary-text">Nut-Free</span>
            </button>
        </div>

        <!-- Cuisine Types Section -->
        <div class="sidebar-section">
            <h3>üåç Cuisine Types</h3>
            <button class="cuisine-option cuisine-italian" onclick="selectCuisine('italian')">
                <span class="cuisine-text">Italian</span>
            </button>
            <button class="cuisine-option cuisine-mexican" onclick="selectCuisine('mexican')">
                <span class="cuisine-text">Mexican</span>
            </button>
            <button class="cuisine-option cuisine-asian" onclick="selectCuisine('asian')">
                <span class="cuisine-text">Asian</span>
            </button>
            <button class="cuisine-option cuisine-indian" onclick="selectCuisine('indian')">
                <span class="cuisine-text">Indian</span>
            </button>
            <button class="cuisine-option cuisine-mediterranean" onclick="selectCuisine('mediterranean')">
                <span class="cuisine-text">Mediterranean</span>
            </button>
            <button class="cuisine-option cuisine-french" onclick="selectCuisine('french')">
                <span class="cuisine-text">French</span>
            </button>
            <button class="cuisine-option cuisine-thai" onclick="selectCuisine('thai')">
                <span class="cuisine-text">Thai</span>
            </button>
            <button class="cuisine-option cuisine-japanese" onclick="selectCuisine('japanese')">
                <span class="cuisine-text">Japanese</span>
            </button>
            <button class="cuisine-option cuisine-greek" onclick="selectCuisine('greek')">
                <span class="cuisine-text">Greek</span>
            </button>
            <button class="cuisine-option cuisine-chinese" onclick="selectCuisine('chinese')">
                <span class="cuisine-text">Chinese</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <div class="title-container">
                <div class="animated-plate">
                    <div class="plate">üçΩÔ∏è</div>
                    <div class="utensils">
                        <span class="fork">üç¥</span>
                        <span class="knife">üî™</span>
                    </div>
                    <div class="food-items">
                        <span class="food-item" data-cuisine="italian">üçù</span>
                        <span class="food-item" data-cuisine="mexican">üåÆ</span>
                        <span class="food-item" data-cuisine="asian">üçú</span>
                        <span class="food-item" data-cuisine="indian">üçõ</span>
                        <span class="food-item" data-cuisine="mediterranean">ü•ô</span>
                        <span class="food-item" data-cuisine="french">ü•ê</span>
                        <span class="food-item" data-cuisine="thai">üç≤</span>
                        <span class="food-item" data-cuisine="japanese">üç±</span>
                        <span class="food-item" data-cuisine="greek">ü•ó</span>
                        <span class="food-item" data-cuisine="chinese">ü•ü</span>
                    </div>
                </div>
                <h1 class="dancing-title">AI Recipe Remix Master</h1>
            </div>
            <p>Transform your ingredients into delicious recipes with world cuisine flavors!</p>
        </div>

        <div class="content-area">
            <!-- Selected Category Display -->
            <div id="selectedCategory" class="selected-category hidden">
                <h3>Selected Filters:</h3>
                <div id="selectedFilters"></div>
            </div>

            <div class="input-section">
                <div class="input-group">
                    <label for="ingredients">üìã Enter your ingredients (comma-separated):</label>
                    <input type="text" id="ingredients" placeholder="e.g., chicken, broccoli, pasta, garlic, olive oil">
                </div>
                
                <button class="btn" onclick="generateRecipe()">üîç Find Recipe</button>
                <button class="btn btn-secondary" onclick="getRandomRecipe()">üé≤ Random Recipe</button>
            </div>

            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Creating your recipe...</p>
            </div>

            <div id="recipeDisplay" class="recipe-display hidden"></div>

            <div class="input-section" id="aiRemixSection" style="display: none;">
                <div class="input-group">
                    <label>ü§ñ AI Recipe Remix</label>
                    <p style="color: #666; margin-bottom: 15px;">Let AI create exciting variations of your recipe!</p>
                </div>
                <button class="btn" onclick="aiRemixRecipe()">üîÑ AI Remix Recipe</button>
                <button class="btn btn-secondary" onclick="getRandomRecipe()">üé≤ Get Random Recipe</button>
            </div>
        </div>
    </div>

    <!-- Fixed Action Bar -->
    <div class="action-bar">
        <button class="action-btn" id="conversionChartBtn">üìè Conversion Chart</button>
        <button class="action-btn" id="saveBtn">üíæ Save</button>
        <button class="action-btn" id="favoriteBtn"><span id="favoriteIcon">ü§ç</span> Favorite</button>
        <button class="action-btn" id="shareBtn">üîó Share</button>
    </div>

    <!-- Conversion Chart Modal -->
    <div id="conversionChartModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" id="closeConversionChart">&times;</span>
            <h2>Measurement Conversion Chart</h2>
            <table>
                <tr><th>Cups</th><th>Ounces</th><th>Tablespoons</th><th>Teaspoons</th></tr>
                <tr><td>1 cup</td><td>8 oz</td><td>16 tbsp</td><td>48 tsp</td></tr>
                <tr><td>1/2 cup</td><td>4 oz</td><td>8 tbsp</td><td>24 tsp</td></tr>
                <tr><td>1/3 cup</td><td>2.7 oz</td><td>5.3 tbsp</td><td>16 tsp</td></tr>
                <tr><td>1/4 cup</td><td>2 oz</td><td>4 tbsp</td><td>12 tsp</td></tr>
                <tr><td>1 tbsp</td><td>0.5 oz</td><td>1 tbsp</td><td>3 tsp</td></tr>
                <tr><td>1 tsp</td><td>0.17 oz</td><td>0.33 tbsp</td><td>1 tsp</td></tr>
            </table>
        </div>
    </div>

    <script>
        // Recipe database
        const RECIPE_DATABASE = [
            {
                name: "Classic Spaghetti Carbonara",
                ingredients: [
                    {item: "spaghetti", amount: 1, unit: "pound", notes: "or 16 oz"},
                    {item: "eggs", amount: 4, unit: "large", notes: "room temperature"},
                    {item: "pecorino romano cheese", amount: 1, unit: "cup", notes: "freshly grated"},
                    {item: "guanciale", amount: 8, unit: "ounces", notes: "or pancetta, cubed"},
                    {item: "black pepper", amount: 1, unit: "teaspoon", notes: "freshly ground"},
                    {item: "salt", amount: 1, unit: "teaspoon", notes: "for pasta water"}
                ],
                instructions: [
                    "Fill a large pot with water and bring to a boil. Add salt to taste.",
                    "Cook spaghetti according to package directions until al dente. Reserve 1 cup of pasta water.",
                    "In a large skillet, cook guanciale over medium heat until crispy and golden brown.",
                    "Remove skillet from heat and add hot pasta to the pan with guanciale.",
                    "In a bowl, whisk together eggs, grated cheese, and black pepper.",
                    "Quickly pour egg mixture over hot pasta, stirring constantly to create a creamy sauce.",
                    "Add reserved pasta water gradually if needed to achieve desired consistency.",
                    "Serve immediately with extra cheese and black pepper on top."
                ],
                prep_time: 15,
                cook_time: 20,
                total_time: 35,
                servings: 4,
                difficulty: "medium",
                cuisine: "italian",
                category: "dinner",
                tags: ["pasta", "quick", "classic", "dinner"],
                dietary: ["vegetarian"],
                tips: [
                    "Use room temperature eggs to prevent scrambling",
                    "Work quickly when combining pasta and eggs",
                    "Reserve pasta water - it's essential for the sauce",
                    "Don't overcook the pasta - al dente is key"
                ]
            },
            {
                name: "Vegetarian Buddha Bowl",
                ingredients: [
                    {item: "quinoa", amount: 1, unit: "cup", notes: "uncooked, rinsed"},
                    {item: "sweet potato", amount: 1, unit: "large", notes: "peeled and cubed into 1-inch pieces"},
                    {item: "chickpeas", amount: 1, unit: "can", notes: "15 oz, drained and rinsed"},
                    {item: "kale", amount: 2, unit: "cups", notes: "chopped, stems removed"},
                    {item: "avocado", amount: 1, unit: "medium", notes: "sliced"},
                    {item: "olive oil", amount: 2, unit: "tablespoons", notes: "extra virgin, divided"},
                    {item: "lemon", amount: 1, unit: "medium", notes: "juiced (about 2 tbsp)"},
                    {item: "garlic", amount: 2, unit: "cloves", notes: "minced"},
                    {item: "salt", amount: 1, unit: "teaspoon", notes: "divided"},
                    {item: "black pepper", amount: 1, unit: "teaspoon", notes: "divided"},
                    {item: "cumin", amount: 0.5, unit: "teaspoon", notes: "ground"},
                    {item: "paprika", amount: 0.5, unit: "teaspoon", notes: "smoked"}
                ],
                instructions: [
                    "Preheat oven to 400¬∞F (200¬∞C). Line a baking sheet with parchment paper.",
                    "Cook quinoa according to package directions. Set aside to keep warm.",
                    "Toss sweet potato cubes with 1 tablespoon olive oil, salt, pepper, cumin, and paprika.",
                    "Spread sweet potatoes on baking sheet and roast for 25-30 minutes until tender.",
                    "In a skillet, heat remaining olive oil and cook garlic for 30 seconds until fragrant.",
                    "Add chickpeas and cook for 5-7 minutes until golden and slightly crispy.",
                    "Massage kale with lemon juice and salt until softened.",
                    "Assemble bowls with quinoa, roasted sweet potatoes, crispy chickpeas, and kale.",
                    "Top with sliced avocado and serve immediately."
                ],
                prep_time: 20,
                cook_time: 30,
                total_time: 50,
                servings: 2,
                difficulty: "easy",
                cuisine: "mediterranean",
                category: "lunch",
                tags: ["healthy", "bowl", "vegetarian", "gluten-free", "lunch"],
                dietary: ["vegetarian", "vegan", "gluten-free"],
                tips: [
                    "Massage kale thoroughly to make it tender",
                    "Don't overcrowd the baking sheet for crispy sweet potatoes",
                    "Rinse quinoa well to remove bitter coating",
                    "Use fresh lemon juice for best flavor"
                ]
            },
            {
                name: "Chocolate Chip Cookies",
                ingredients: [
                    {item: "all-purpose flour", amount: 2.25, unit: "cups", notes: "spooned and leveled"},
                    {item: "butter", amount: 1, unit: "cup", notes: "unsalted, softened to room temperature"},
                    {item: "brown sugar", amount: 0.75, unit: "cup", notes: "packed, light or dark"},
                    {item: "white sugar", amount: 0.75, unit: "cup", notes: "granulated"},
                    {item: "eggs", amount: 2, unit: "large", notes: "room temperature"},
                    {item: "vanilla extract", amount: 2, unit: "teaspoons", notes: "pure vanilla extract"},
                    {item: "chocolate chips", amount: 2, unit: "cups", notes: "semi-sweet or dark"},
                    {item: "baking soda", amount: 1, unit: "teaspoon", notes: ""},
                    {item: "salt", amount: 1, unit: "teaspoon", notes: "fine sea salt"},
                    {item: "walnuts", amount: 1, unit: "cup", notes: "chopped, optional"}
                ],
                instructions: [
                    "Preheat oven to 375¬∞F (190¬∞C). Line baking sheets with parchment paper.",
                    "In a medium bowl, whisk together flour, baking soda, and salt. Set aside.",
                    "In a large bowl, cream together softened butter, brown sugar, and white sugar until light and fluffy.",
                    "Add eggs one at a time, beating well after each addition. Beat in vanilla extract.",
                    "Gradually add dry ingredients to wet ingredients, mixing until just combined.",
                    "Fold in chocolate chips and walnuts (if using) until evenly distributed.",
                    "Drop rounded tablespoons of dough onto prepared baking sheets, spacing 2 inches apart.",
                    "Bake for 9-11 minutes until edges are golden brown but centers are still soft.",
                    "Cool on baking sheets for 5 minutes, then transfer to wire racks to cool completely."
                ],
                prep_time: 25,
                cook_time: 10,
                total_time: 35,
                servings: 24,
                difficulty: "easy",
                cuisine: "american",
                category: "desserts",
                tags: ["dessert", "baking", "cookies", "chocolate", "sweet"],
                dietary: ["vegetarian"],
                tips: [
                    "Use room temperature ingredients for best results",
                    "Don't overmix the dough - it makes cookies tough",
                    "Let cookies cool on baking sheet for 5 minutes before moving",
                    "Store in an airtight container to keep them fresh"
                ]
            },
            {
                name: "Quick Breakfast Bowl",
                requires: ["eggs", "bread"],
                ingredients: [
                    {item: "eggs", amount: 2, unit: "large", notes: ""},
                    {item: "bread", amount: 2, unit: "slices", notes: "toasted and cubed"},
                    {item: "butter", amount: 1, unit: "tablespoon", notes: "or olive oil"},
                    {item: "milk", amount: 2, unit: "tablespoons", notes: "optional, for fluffier eggs"},
                    {item: "salt", amount: 0.5, unit: "teaspoon", notes: "to taste"},
                    {item: "black pepper", amount: 0.25, unit: "teaspoon", notes: "to taste"},
                    {item: "herbs", amount: 1, unit: "tablespoon", notes: "fresh chives or parsley (optional)"}
                ],
                instructions: [
                    "Toast bread and cut into small cubes.",
                    "In a bowl, whisk eggs with milk, salt, and pepper.",
                    "Heat butter in a non-stick skillet over medium heat.",
                    "Add bread cubes and toast for 1-2 minutes until golden.",
                    "Pour egg mixture over bread and cook, stirring gently, until eggs are set.",
                    "Garnish with fresh herbs if using.",
                    "Serve immediately while hot."
                ],
                category: "breakfast",
                cuisine: "american",
                difficulty: "easy"
            },
            {
                name: "Mexican Quesadillas",
                requires: ["tortillas", "cheese"],
                ingredients: [
                    {item: "tortillas", amount: 4, unit: "large", notes: "flour or corn tortillas"},
                    {item: "cheese", amount: 1.5, unit: "cups", notes: "shredded cheddar, monterey jack, or mexican blend"},
                    {item: "bell peppers", amount: 1, unit: "medium", notes: "sliced (optional)"},
                    {item: "onion", amount: 0.5, unit: "medium", notes: "sliced (optional)"},
                    {item: "olive oil", amount: 1, unit: "tablespoon", notes: "for cooking"},
                    {item: "salsa", amount: 0.5, unit: "cup", notes: "for serving"},
                    {item: "sour cream", amount: 0.25, unit: "cup", notes: "for serving (optional)"},
                    {item: "salt", amount: 0.5, unit: "teaspoon", notes: "to taste"}
                ],
                instructions: [
                    "Heat olive oil in a large skillet over medium heat.",
                    "Add sliced peppers and onions if using, cook for 2-3 minutes until softened.",
                    "Remove vegetables and set aside.",
                    "Place one tortilla in the skillet and sprinkle half the cheese on top.",
                    "Add vegetables if using, then top with remaining cheese and second tortilla.",
                    "Cook for 2-3 minutes until bottom is golden, then carefully flip.",
                    "Cook for another 2-3 minutes until cheese is melted and both sides are golden.",
                    "Cut into wedges and serve with salsa and sour cream."
                ],
                category: "appetizers",
                cuisine: "mexican",
                difficulty: "easy"
            },
            {
                name: "Vegetarian Buddha Bowl",
                requires: ["quinoa", "vegetables"],
                ingredients: [
                    {item: "quinoa", amount: 1, unit: "cup", notes: "uncooked, rinsed"},
                    {item: "mixed vegetables", amount: 3, unit: "cups", notes: "sweet potato, chickpeas, kale, avocado"},
                    {item: "olive oil", amount: 2, unit: "tablespoons", notes: "extra virgin, divided"},
                    {item: "lemon", amount: 1, unit: "medium", notes: "juiced (about 2 tbsp)"},
                    {item: "garlic", amount: 2, unit: "cloves", notes: "minced"},
                    {item: "salt", amount: 1, unit: "teaspoon", notes: "divided"},
                    {item: "black pepper", amount: 1, unit: "teaspoon", notes: "divided"},
                    {item: "cumin", amount: 0.5, unit: "teaspoon", notes: "ground"},
                    {item: "paprika", amount: 0.5, unit: "teaspoon", notes: "smoked"}
                ],
                instructions: [
                    "Cook quinoa according to package directions. Set aside to keep warm.",
                    "Preheat oven to 400¬∞F (200¬∞C). Line a baking sheet with parchment paper.",
                    "Toss vegetables with 1 tablespoon olive oil, salt, pepper, cumin, and paprika.",
                    "Spread vegetables on baking sheet and roast for 25-30 minutes until tender.",
                    "In a skillet, heat remaining olive oil and cook garlic for 30 seconds until fragrant.",
                    "Add chickpeas if using and cook for 5-7 minutes until golden and slightly crispy.",
                    "Massage kale with lemon juice and salt until softened.",
                    "Assemble bowls with quinoa, roasted vegetables, and kale.",
                    "Top with sliced avocado if using and serve immediately."
                ],
                category: "lunch",
                cuisine: "vegetarian",
                difficulty: "medium"
            },
            {
                name: "Quick Smoothie Bowl",
                requires: ["banana", "berries"],
                ingredients: [
                    {item: "banana", amount: 1, unit: "large", notes: "frozen, sliced"},
                    {item: "mixed berries", amount: 1, unit: "cup", notes: "frozen strawberries, blueberries, raspberries"},
                    {item: "yogurt", amount: 0.5, unit: "cup", notes: "greek yogurt or plant-based alternative"},
                    {item: "milk", amount: 0.25, unit: "cup", notes: "dairy or plant-based milk"},
                    {item: "honey", amount: 1, unit: "tablespoon", notes: "or maple syrup"},
                    {item: "granola", amount: 0.25, unit: "cup", notes: "for topping"},
                    {item: "nuts", amount: 2, unit: "tablespoons", notes: "chopped almonds or walnuts (optional)"},
                    {item: "coconut flakes", amount: 1, unit: "tablespoon", notes: "for garnish (optional)"}
                ],
                instructions: [
                    "In a blender, combine frozen banana, berries, yogurt, milk, and honey.",
                    "Blend until smooth and creamy, adding more milk if needed.",
                    "Pour into a bowl and top with granola, nuts, and coconut flakes.",
                    "Serve immediately while cold and creamy."
                ],
                category: "breakfast",
                cuisine: "american",
                difficulty: "easy"
            },
            {
                name: "Apple Cinnamon Crisp",
                requires: ["apples", "cinnamon", "sugar"],
                ingredients: [
                    {item: "apples", amount: 4, unit: "medium", notes: "peeled, cored, and sliced"},
                    {item: "cinnamon", amount: 1, unit: "teaspoon", notes: "ground"},
                    {item: "sugar", amount: 0.5, unit: "cup", notes: "divided"},
                    {item: "all-purpose flour", amount: 1, unit: "cup", notes: ""},
                    {item: "oats", amount: 1, unit: "cup", notes: "old-fashioned"},
                    {item: "butter", amount: 0.5, unit: "cup", notes: "cold, cubed"},
                    {item: "lemon juice", amount: 1, unit: "tablespoon", notes: "fresh"},
                    {item: "salt", amount: 0.25, unit: "teaspoon", notes: ""},
                    {item: "vanilla extract", amount: 1, unit: "teaspoon", notes: ""}
                ],
                instructions: [
                    "Preheat oven to 375¬∞F (190¬∞C). Grease a 9-inch baking dish.",
                    "In a large bowl, toss sliced apples with 1/4 cup sugar, cinnamon, lemon juice, and vanilla.",
                    "Spread apple mixture evenly in the prepared baking dish.",
                    "In another bowl, combine flour, oats, remaining 1/4 cup sugar, and salt.",
                    "Cut in cold butter until mixture resembles coarse crumbs.",
                    "Sprinkle crumb mixture evenly over apples.",
                    "Bake for 30-35 minutes until topping is golden brown and apples are tender.",
                    "Let cool for 10 minutes before serving. Serve warm with ice cream if desired."
                ],
                category: "desserts",
                cuisine: "american",
                difficulty: "easy"
            },
            {
                name: "Cinnamon Sugar Apple Pie",
                requires: ["apples", "cinnamon", "sugar"],
                ingredients: [
                    {item: "apples", amount: 6, unit: "medium", notes: "peeled, cored, and thinly sliced"},
                    {item: "cinnamon", amount: 1.5, unit: "teaspoons", notes: "ground"},
                    {item: "sugar", amount: 0.75, unit: "cup", notes: "divided"},
                    {item: "pie crust", amount: 2, unit: "9-inch", notes: "store-bought or homemade"},
                    {item: "all-purpose flour", amount: 0.25, unit: "cup", notes: ""},
                    {item: "butter", amount: 2, unit: "tablespoons", notes: "cold, cubed"},
                    {item: "lemon juice", amount: 1, unit: "tablespoon", notes: "fresh"},
                    {item: "egg", amount: 1, unit: "large", notes: "beaten, for egg wash"},
                    {item: "salt", amount: 0.25, unit: "teaspoon", notes: ""}
                ],
                instructions: [
                    "Preheat oven to 425¬∞F (220¬∞C).",
                    "In a large bowl, combine sliced apples, 1/2 cup sugar, cinnamon, flour, lemon juice, and salt.",
                    "Line a 9-inch pie dish with one pie crust.",
                    "Fill with apple mixture and dot with butter.",
                    "Cover with second pie crust and crimp edges to seal.",
                    "Cut several slits in the top crust for steam to escape.",
                    "Brush with beaten egg and sprinkle with remaining 1/4 cup sugar.",
                    "Bake for 15 minutes, then reduce temperature to 350¬∞F (175¬∞C).",
                    "Continue baking for 35-40 minutes until crust is golden and filling is bubbling.",
                    "Let cool for at least 2 hours before serving."
                ],
                category: "desserts",
                cuisine: "american",
                difficulty: "medium"
            },
            {
                name: "Baked Salmon with Garlic",
                requires: ["salmon", "garlic"],
                ingredients: [
                    {item: "salmon fillets", amount: 4, unit: "6-ounce", notes: "skin-on, pin bones removed"},
                    {item: "garlic", amount: 4, unit: "cloves", notes: "minced"},
                    {item: "lemon", amount: 2, unit: "medium", notes: "1 sliced, 1 for juice"},
                    {item: "olive oil", amount: 2, unit: "tablespoons", notes: "extra virgin"},
                    {item: "oregano", amount: 1, unit: "teaspoon", notes: "dried"},
                    {item: "thyme", amount: 1, unit: "teaspoon", notes: "dried"},
                    {item: "cherry tomatoes", amount: 1, unit: "cup", notes: "halved"},
                    {item: "salt", amount: 1, unit: "teaspoon", notes: "divided"},
                    {item: "black pepper", amount: 1, unit: "teaspoon", notes: "divided"},
                    {item: "fresh parsley", amount: 0.25, unit: "cup", notes: "chopped, for garnish"}
                ],
                instructions: [
                    "Preheat oven to 400¬∞F (200¬∞C). Line a baking sheet with parchment paper.",
                    "Pat salmon fillets dry and place skin-side down on the prepared baking sheet.",
                    "Drizzle each fillet with olive oil and season with salt, pepper, oregano, and thyme.",
                    "Sprinkle minced garlic over each fillet and arrange lemon slices on top.",
                    "Scatter cherry tomatoes around the salmon.",
                    "Bake for 12-15 minutes until salmon flakes easily with a fork.",
                    "Let rest for 5 minutes, then garnish with fresh parsley.",
                    "Serve immediately with additional lemon wedges."
                ],
                category: "dinner",
                cuisine: "mediterranean",
                difficulty: "easy"
            },
            {
                name: "Garlic Butter Shrimp",
                requires: ["shrimp", "garlic"],
                ingredients: [
                    {item: "shrimp", amount: 1, unit: "pound", notes: "peeled and deveined"},
                    {item: "garlic", amount: 6, unit: "cloves", notes: "minced"},
                    {item: "butter", amount: 4, unit: "tablespoons", notes: "unsalted"},
                    {item: "olive oil", amount: 2, unit: "tablespoons", notes: "extra virgin"},
                    {item: "lemon", amount: 1, unit: "medium", notes: "juiced and zested"},
                    {item: "parsley", amount: 0.25, unit: "cup", notes: "fresh, chopped"},
                    {item: "salt", amount: 0.5, unit: "teaspoon", notes: "to taste"},
                    {item: "black pepper", amount: 0.25, unit: "teaspoon", notes: "to taste"},
                    {item: "red pepper flakes", amount: 0.25, unit: "teaspoon", notes: "optional"}
                ],
                instructions: [
                    "Pat shrimp dry with paper towels and season with salt and pepper.",
                    "In a large skillet, heat butter and olive oil over medium-high heat.",
                    "Add minced garlic and cook for 30 seconds until fragrant.",
                    "Add shrimp in a single layer and cook for 2-3 minutes per side until pink and opaque.",
                    "Add lemon juice, zest, and red pepper flakes if using.",
                    "Toss shrimp with garlic butter sauce for 1 minute.",
                    "Remove from heat and stir in fresh parsley.",
                    "Serve immediately with crusty bread or over pasta."
                ],
                category: "dinner",
                cuisine: "mediterranean",
                difficulty: "easy"
            }
        ];

        // Global variables for selections
        let selectedCategories = [];
        let selectedDietary = [];
        let selectedCuisines = [];
        let currentRecipe = null;

        // Category selection
        function selectCategory(category) {
            const button = event.target;
            const index = selectedCategories.indexOf(category);
            
            if (index > -1) {
                // Remove selection
                selectedCategories.splice(index, 1);
                button.classList.remove('active');
            } else {
                // Add selection
                selectedCategories.push(category);
                button.classList.add('active');
            }
            
            updateSelectedFilters();
        }

        // Dietary selection
        function selectDietary(dietary) {
            const button = event.target;
            const index = selectedDietary.indexOf(dietary);
            
            if (index > -1) {
                // Remove selection
                selectedDietary.splice(index, 1);
                button.classList.remove('active');
            } else {
                // Add selection
                selectedDietary.push(dietary);
                button.classList.add('active');
            }
            
            updateSelectedFilters();
        }

        // Cuisine selection
        function selectCuisine(cuisine) {
            const button = event.target;
            const index = selectedCuisines.indexOf(cuisine);
            
            if (index > -1) {
                // Remove selection
                selectedCuisines.splice(index, 1);
                button.classList.remove('active');
            } else {
                // Add selection
                selectedCuisines.push(cuisine);
                button.classList.add('active');
            }
            
            updateSelectedFilters();
        }

        // Update selected filters display
        function updateSelectedFilters() {
            const filtersDiv = document.getElementById('selectedFilters');
            const selectedCategoryDiv = document.getElementById('selectedCategory');
            
            let filters = [];
            if (selectedCategories.length > 0) {
                filters.push(`Categories: ${selectedCategories.map(c => c.charAt(0).toUpperCase() + c.slice(1)).join(', ')}`);
            }
            if (selectedDietary.length > 0) {
                filters.push(`Dietary: ${selectedDietary.join(', ')}`);
            }
            if (selectedCuisines.length > 0) {
                filters.push(`Cuisines: ${selectedCuisines.map(c => c.charAt(0).toUpperCase() + c.slice(1)).join(', ')}`);
            }
            
            if (filters.length > 0) {
                filtersDiv.innerHTML = filters.join(' | ');
                selectedCategoryDiv.classList.remove('hidden');
            } else {
                selectedCategoryDiv.classList.add('hidden');
            }
        }

        // Clear all selections
        function clearSelections() {
            selectedCategories = [];
            selectedDietary = [];
            selectedCuisines = [];
            
            // Remove active class from all buttons
            document.querySelectorAll('.category-item, .dietary-option, .cuisine-option').forEach(item => {
                item.classList.remove('active');
            });
            
            updateSelectedFilters();
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('recipeDisplay').classList.add('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function formatRecipe(recipe) {
            let formatted = `üçΩÔ∏è ${recipe.name}\n\n`;
            
            // Ingredients section
            formatted += "üìã Ingredients:\n";
            for (let ingredient of recipe.ingredients) {
                let amount = ingredient.amount;
                if (Number.isInteger(amount)) {
                    amount = amount.toString();
                }
                formatted += `- ${amount} ${ingredient.unit} ${ingredient.item}`;
                if (ingredient.notes) {
                    formatted += ` (${ingredient.notes})`;
                }
                formatted += "\n";
            }
            
            // Instructions section
            formatted += `\nüë®‚Äçüç≥ Instructions:\n`;
            for (let i = 0; i < recipe.instructions.length; i++) {
                formatted += `${i + 1}. ${recipe.instructions[i]}\n`;
            }
            
            // Additional info
            formatted += `\n‚è±Ô∏è Prep Time: ${recipe.prep_time} minutes\n`;
            formatted += `üî• Cook Time: ${recipe.cook_time} minutes\n`;
            formatted += `‚è∞ Total Time: ${recipe.total_time} minutes\n`;
            formatted += `üë• Servings: ${recipe.servings}\n`;
            formatted += `üìä Difficulty: ${recipe.difficulty.charAt(0).toUpperCase() + recipe.difficulty.slice(1)}\n`;
            formatted += `üåç Cuisine: ${recipe.cuisine.charAt(0).toUpperCase() + recipe.cuisine.slice(1)}\n`;
            formatted += `üè∑Ô∏è Category: ${recipe.category.charAt(0).toUpperCase() + recipe.category.slice(1)}\n`;
            
            if (recipe.tags) {
                formatted += `üè∑Ô∏è Tags: ${recipe.tags.join(', ')}\n`;
            }
            
            if (recipe.dietary) {
                formatted += `ü•ó Dietary: ${recipe.dietary.join(', ')}\n`;
            }
            
            // Tips section
            if (recipe.tips) {
                formatted += `\nüí° Chef's Tips:\n`;
                for (let tip of recipe.tips) {
                    formatted += `‚Ä¢ ${tip}\n`;
                }
            }
            
            return formatted;
        }

        function findRecipesByIngredients(ingredients) {
            const ingredientsLower = ingredients.map(ing => ing.toLowerCase());
            const matchingRecipes = [];
            
            for (let recipe of RECIPE_DATABASE) {
                const recipeIngredients = recipe.ingredients.map(ing => ing.item.toLowerCase());
                
                const matches = ingredientsLower.filter(ing => 
                    recipeIngredients.some(recipeIng => {
                        // Direct match
                        if (recipeIng.includes(ing) || ing.includes(recipeIng)) return true;
                        
                        // Word-based matching for compound ingredients
                        const ingWords = ing.split(' ');
                        const recipeIngWords = recipeIng.split(' ');
                        
                        // Check if any word in the user ingredient matches any word in the recipe ingredient
                        return ingWords.some(ingWord => 
                            recipeIngWords.some(recipeWord => 
                                recipeWord.includes(ingWord) || ingWord.includes(recipeWord)
                            )
                        );
                    })
                );
                
                if (matches.length > 0) {
                    const recipeCopy = {...recipe};
                    recipeCopy.matching_ingredients = matches;
                    recipeCopy.match_score = matches.length;
                    matchingRecipes.push(recipeCopy);
                }
            }
            
            matchingRecipes.sort((a, b) => b.match_score - a.match_score);
            return matchingRecipes;
        }

        function filterRecipesBySelections(recipes) {
            let filtered = recipes;
            
            if (selectedCategories.length > 0) {
                filtered = filtered.filter(recipe => 
                    selectedCategories.some(category => 
                        recipe.category === category || 
                        recipe.tags.includes(category)
                    )
                );
            }
            
            if (selectedDietary.length > 0) {
                filtered = filtered.filter(recipe => 
                    recipe.dietary && selectedDietary.every(diet => recipe.dietary.includes(diet))
                );
            }
            
            if (selectedCuisines.length > 0) {
                filtered = filtered.filter(recipe => 
                    selectedCuisines.some(cuisine => recipe.cuisine === cuisine)
                );
            }
            
            return filtered;
        }

        function generateRecipe() {
            const ingredientsInput = document.getElementById('ingredients').value.trim();
            if (!ingredientsInput) {
                alert('Please enter some ingredients!');
                return;
            }

            showLoading();

            setTimeout(() => {
                const userIngredients = ingredientsInput.split(',').map(ing => ing.trim());
                const userIngredientsLower = userIngredients.map(ing => ing.toLowerCase());
                
                // First, try to find existing recipes that contain the user's ingredients
                let matchingRecipes = findRecipesByIngredients(userIngredients);
                
                // Apply filters if any are selected
                if (selectedCategories.length > 0 || selectedDietary.length > 0 || selectedCuisines.length > 0) {
                    matchingRecipes = filterRecipesBySelections(matchingRecipes);
                }
                
                // Only use existing recipe if it actually contains the user's ingredients
                let validExistingRecipe = null;
                for (let recipe of matchingRecipes) {
                    const recipeIngredients = recipe.ingredients.map(ing => ing.item.toLowerCase());
                    const hasUserIngredients = userIngredientsLower.some(userIng => 
                        recipeIngredients.some(recipeIng => 
                            recipeIng.includes(userIng) || userIng.includes(recipeIng)
                        )
                    );
                    if (hasUserIngredients) {
                        validExistingRecipe = recipe;
                        break;
                    }
                }
                
                if (validExistingRecipe) {
                    // Use existing recipe that contains user's ingredients
                    currentRecipe = validExistingRecipe;
                    const formatted = formatRecipe(currentRecipe);
                    displayRecipe(formatted);
                } else {
                    // Generate a new recipe that MUST use the user's ingredients
                    currentRecipe = generateNewRecipeFromIngredients(userIngredients);
                    const formatted = formatRecipe(currentRecipe);
                    displayRecipe(formatted);
                }
                hideLoading();
            }, 1500);
        }

        function generateNewRecipeFromIngredients(ingredients) {
            const ingredientsLower = ingredients.map(ing => ing.toLowerCase());
            
            // Recipe templates based on ingredient combinations
            const recipeTemplates = [
                {
                    name: "Garlic Bread Pizza",
                    requires: ["sourdough bread", "garlic", "tomato sauce", "cheese"],
                    ingredients: [
                        {item: "sourdough bread", amount: 4, unit: "slices", notes: "or 1 small loaf"},
                        {item: "garlic", amount: 4, unit: "cloves", notes: "minced"},
                        {item: "tomato sauce", amount: 0.5, unit: "cup", notes: "pizza or marinara sauce"},
                        {item: "cheese", amount: 1, unit: "cup", notes: "shredded mozzarella or your favorite"},
                        {item: "olive oil", amount: 2, unit: "tablespoons", notes: "extra virgin"},
                        {item: "italian seasoning", amount: 1, unit: "teaspoon", notes: "dried"},
                        {item: "salt", amount: 0.5, unit: "teaspoon", notes: "to taste"},
                        {item: "black pepper", amount: 0.25, unit: "teaspoon", notes: "to taste"}
                    ],
                    instructions: [
                        "Preheat oven to 400¬∞F (200¬∞C).",
                        "Brush both sides of bread slices with olive oil and place on baking sheet.",
                        "Toast bread for 5-7 minutes until lightly golden.",
                        "Remove from oven and spread tomato sauce on each slice.",
                        "Sprinkle minced garlic over the sauce.",
                        "Top with shredded cheese and Italian seasoning.",
                        "Return to oven and bake for 8-10 minutes until cheese is melted and bubbly.",
                        "Season with salt and pepper to taste. Serve immediately."
                    ],
                    category: "appetizers",
                    cuisine: "italian",
                    difficulty: "easy"
                },
                {
                    name: "Quick Pasta with Tomato Sauce",
                    requires: ["pasta", "tomato sauce", "garlic"],
                    ingredients: [
                        {item: "pasta", amount: 8, unit: "ounces", notes: "spaghetti, penne, or your choice"},
                        {item: "tomato sauce", amount: 1, unit: "cup", notes: "marinara or your favorite sauce"},
                        {item: "garlic", amount: 3, unit: "cloves", notes: "minced"},
                        {item: "olive oil", amount: 2, unit: "tablespoons", notes: "extra virgin"},
                        {item: "basil", amount: 0.25, unit: "cup", notes: "fresh, chopped (optional)"},
                        {item: "parmesan cheese", amount: 0.25, unit: "cup", notes: "freshly grated"},
                        {item: "salt", amount: 1, unit: "teaspoon", notes: "for pasta water"},
                        {item: "black pepper", amount: 0.5, unit: "teaspoon", notes: "to taste"}
                    ],
                    instructions: [
                        "Bring a large pot of salted water to boil and cook pasta according to package directions.",
                        "While pasta cooks, heat olive oil in a large skillet over medium heat.",
                        "Add minced garlic and saut√© for 30 seconds until fragrant.",
                        "Pour in tomato sauce and simmer for 5-7 minutes.",
                        "Drain pasta, reserving 1/2 cup of pasta water.",
                        "Add pasta to the sauce and toss to combine.",
                        "Add pasta water if needed to achieve desired consistency.",
                        "Stir in fresh basil and top with grated parmesan.",
                        "Season with salt and pepper to taste. Serve immediately."
                    ],
                    category: "dinner",
                    cuisine: "italian",
                    difficulty: "easy"
                },
                {
                    name: "Chicken Stir-Fry",
                    requires: ["chicken", "vegetables"],
                    ingredients: [
                        {item: "chicken breast", amount: 1, unit: "pound", notes: "sliced into strips"},
                        {item: "mixed vegetables", amount: 3, unit: "cups", notes: "broccoli, bell peppers, carrots"},
                        {item: "soy sauce", amount: 3, unit: "tablespoons", notes: "low sodium"},
                        {item: "sesame oil", amount: 1, unit: "tablespoon", notes: "toasted"},
                        {item: "garlic", amount: 3, unit: "cloves", notes: "minced"},
                        {item: "ginger", amount: 1, unit: "tablespoon", notes: "fresh, grated"},
                        {item: "vegetable oil", amount: 2, unit: "tablespoons", notes: "for cooking"},
                        {item: "cornstarch", amount: 1, unit: "teaspoon", notes: "for thickening"},
                        {item: "rice vinegar", amount: 1, unit: "tablespoon", notes: ""},
                        {item: "honey", amount: 1, unit: "teaspoon", notes: "or brown sugar"}
                    ],
                    instructions: [
                        "Slice chicken into thin strips and marinate with 1 tablespoon soy sauce and cornstarch for 10 minutes.",
                        "Heat 1 tablespoon vegetable oil in a wok or large skillet over high heat.",
                        "Add chicken and stir-fry for 5-7 minutes until cooked through. Remove to a plate.",
                        "Add remaining oil to the same pan and cook garlic and ginger for 30 seconds.",
                        "Add vegetables and stir-fry for 2-3 minutes until crisp-tender.",
                        "Return chicken to pan and add remaining soy sauce, sesame oil, rice vinegar, and honey.",
                        "Toss everything together for 1-2 minutes until sauce coats all ingredients.",
                        "Serve immediately over steamed rice or noodles."
                    ],
                    category: "dinner",
                    cuisine: "asian",
                    difficulty: "medium"
                },
                {
                    name: "Simple Salad",
                    requires: ["lettuce", "vegetables"],
                    ingredients: [
                        {item: "lettuce", amount: 1, unit: "head", notes: "romaine, iceberg, or mixed greens"},
                        {item: "mixed vegetables", amount: 2, unit: "cups", notes: "tomatoes, cucumbers, carrots"},
                        {item: "olive oil", amount: 2, unit: "tablespoons", notes: "extra virgin"},
                        {item: "lemon juice", amount: 1, unit: "tablespoon", notes: "fresh"},
                        {item: "garlic", amount: 1, unit: "clove", notes: "minced"},
                        {item: "salt", amount: 0.5, unit: "teaspoon", notes: "to taste"},
                        {item: "black pepper", amount: 0.25, unit: "teaspoon", notes: "to taste"},
                        {item: "herbs", amount: 0.25, unit: "cup", notes: "fresh basil, parsley, or dill (optional)"}
                    ],
                    instructions: [
                        "Wash and chop lettuce into bite-sized pieces.",
                        "Chop all vegetables into similar-sized pieces.",
                        "In a small bowl, whisk together olive oil, lemon juice, minced garlic, salt, and pepper.",
                        "In a large bowl, combine lettuce and vegetables.",
                        "Pour dressing over salad and toss gently to coat.",
                        "Add fresh herbs if using and toss again.",
                        "Serve immediately for best texture and flavor."
                    ],
                    category: "salads",
                    cuisine: "mediterranean",
                    difficulty: "easy"
                },
                {
                    name: "Quick Breakfast Bowl",
                    requires: ["eggs", "bread"],
                    ingredients: [
                        {item: "eggs", amount: 2, unit: "large", notes: ""},
                        {item: "bread", amount: 2, unit: "slices", notes: "toasted and cubed"},
                        {item: "butter", amount: 1, unit: "tablespoon", notes: "or olive oil"},
                        {item: "milk", amount: 2, unit: "tablespoons", notes: "optional, for fluffier eggs"},
                        {item: "salt", amount: 0.5, unit: "teaspoon", notes: "to taste"},
                        {item: "black pepper", amount: 0.25, unit: "teaspoon", notes: "to taste"},
                        {item: "herbs", amount: 1, unit: "tablespoon", notes: "fresh chives or parsley (optional)"}
                    ],
                    instructions: [
                        "Toast bread and cut into small cubes.",
                        "In a bowl, whisk eggs with milk, salt, and pepper.",
                        "Heat butter in a non-stick skillet over medium heat.",
                        "Add bread cubes and toast for 1-2 minutes until golden.",
                        "Pour egg mixture over bread and cook, stirring gently, until eggs are set.",
                        "Garnish with fresh herbs if using.",
                        "Serve immediately while hot."
                    ],
                    category: "breakfast",
                    cuisine: "american",
                    difficulty: "easy"
                },
                {
                    name: "Mexican Quesadillas",
                    requires: ["tortillas", "cheese"],
                    ingredients: [
                        {item: "tortillas", amount: 4, unit: "large", notes: "flour or corn tortillas"},
                        {item: "cheese", amount: 1.5, unit: "cups", notes: "shredded cheddar, monterey jack, or mexican blend"},
                        {item: "bell peppers", amount: 1, unit: "medium", notes: "sliced (optional)"},
                        {item: "onion", amount: 0.5, unit: "medium", notes: "sliced (optional)"},
                        {item: "olive oil", amount: 1, unit: "tablespoon", notes: "for cooking"},
                        {item: "salsa", amount: 0.5, unit: "cup", notes: "for serving"},
                        {item: "sour cream", amount: 0.25, unit: "cup", notes: "for serving (optional)"},
                        {item: "salt", amount: 0.5, unit: "teaspoon", notes: "to taste"}
                    ],
                    instructions: [
                        "Heat olive oil in a large skillet over medium heat.",
                        "Add sliced peppers and onions if using, cook for 2-3 minutes until softened.",
                        "Remove vegetables and set aside.",
                        "Place one tortilla in the skillet and sprinkle half the cheese on top.",
                        "Add vegetables if using, then top with remaining cheese and second tortilla.",
                        "Cook for 2-3 minutes until bottom is golden, then carefully flip.",
                        "Cook for another 2-3 minutes until cheese is melted and both sides are golden.",
                        "Cut into wedges and serve with salsa and sour cream."
                    ],
                    category: "appetizers",
                    cuisine: "mexican",
                    difficulty: "easy"
                },
                {
                    name: "Vegetarian Buddha Bowl",
                    requires: ["quinoa", "vegetables"],
                    ingredients: [
                        {item: "quinoa", amount: 1, unit: "cup", notes: "uncooked, rinsed"},
                        {item: "mixed vegetables", amount: 3, unit: "cups", notes: "sweet potato, chickpeas, kale, avocado"},
                        {item: "olive oil", amount: 2, unit: "tablespoons", notes: "extra virgin, divided"},
                        {item: "lemon", amount: 1, unit: "medium", notes: "juiced (about 2 tbsp)"},
                        {item: "garlic", amount: 2, unit: "cloves", notes: "minced"},
                        {item: "salt", amount: 1, unit: "teaspoon", notes: "divided"},
                        {item: "black pepper", amount: 1, unit: "teaspoon", notes: "divided"},
                        {item: "cumin", amount: 0.5, unit: "teaspoon", notes: "ground"},
                        {item: "paprika", amount: 0.5, unit: "teaspoon", notes: "smoked"}
                    ],
                    instructions: [
                        "Cook quinoa according to package directions. Set aside to keep warm.",
                        "Preheat oven to 400¬∞F (200¬∞C). Line a baking sheet with parchment paper.",
                        "Toss vegetables with 1 tablespoon olive oil, salt, pepper, cumin, and paprika.",
                        "Spread vegetables on baking sheet and roast for 25-30 minutes until tender.",
                        "In a skillet, heat remaining olive oil and cook garlic for 30 seconds until fragrant.",
                        "Add chickpeas if using and cook for 5-7 minutes until golden and slightly crispy.",
                        "Massage kale with lemon juice and salt until softened.",
                        "Assemble bowls with quinoa, roasted vegetables, and kale.",
                        "Top with sliced avocado if using and serve immediately."
                    ],
                    category: "lunch",
                    cuisine: "vegetarian",
                    difficulty: "medium"
                },
                {
                    name: "Quick Smoothie Bowl",
                    requires: ["banana", "berries"],
                    ingredients: [
                        {item: "banana", amount: 1, unit: "large", notes: "frozen, sliced"},
                        {item: "mixed berries", amount: 1, unit: "cup", notes: "frozen strawberries, blueberries, raspberries"},
                        {item: "yogurt", amount: 0.5, unit: "cup", notes: "greek yogurt or plant-based alternative"},
                        {item: "milk", amount: 0.25, unit: "cup", notes: "dairy or plant-based milk"},
                        {item: "honey", amount: 1, unit: "tablespoon", notes: "or maple syrup"},
                        {item: "granola", amount: 0.25, unit: "cup", notes: "for topping"},
                        {item: "nuts", amount: 2, unit: "tablespoons", notes: "chopped almonds or walnuts (optional)"},
                        {item: "coconut flakes", amount: 1, unit: "tablespoon", notes: "for garnish (optional)"}
                    ],
                    instructions: [
                        "In a blender, combine frozen banana, berries, yogurt, milk, and honey.",
                        "Blend until smooth and creamy, adding more milk if needed.",
                        "Pour into a bowl and top with granola, nuts, and coconut flakes.",
                        "Serve immediately while cold and creamy."
                    ],
                    category: "breakfast",
                    cuisine: "american",
                    difficulty: "easy"
                },
                {
                    name: "Roasted Pumpkin Soup",
                    requires: ["pumpkin", "squash"],
                    ingredients: [
                        {item: "pumpkin", amount: 1, unit: "small", notes: "or butternut squash, peeled and cubed"},
                        {item: "squash", amount: 1, unit: "medium", notes: "butternut or acorn squash, peeled and cubed"},
                        {item: "onion", amount: 1, unit: "large", notes: "chopped"},
                        {item: "garlic", amount: 3, unit: "cloves", notes: "minced"},
                        {item: "vegetable broth", amount: 4, unit: "cups", notes: "or chicken broth"},
                        {item: "olive oil", amount: 2, unit: "tablespoons", notes: "extra virgin"},
                        {item: "salt", amount: 1, unit: "teaspoon", notes: "to taste"},
                        {item: "black pepper", amount: 0.5, unit: "teaspoon", notes: "to taste"},
                        {item: "nutmeg", amount: 0.25, unit: "teaspoon", notes: "ground"},
                        {item: "heavy cream", amount: 0.5, unit: "cup", notes: "optional, for richness"}
                    ],
                    instructions: [
                        "Preheat oven to 400¬∞F (200¬∞C). Line a baking sheet with parchment paper.",
                        "Toss pumpkin and squash cubes with 1 tablespoon olive oil, salt, and pepper.",
                        "Spread on baking sheet and roast for 25-30 minutes until tender and slightly caramelized.",
                        "In a large pot, heat remaining olive oil over medium heat.",
                        "Add chopped onion and cook for 5 minutes until softened.",
                        "Add minced garlic and cook for 30 seconds until fragrant.",
                        "Add roasted pumpkin and squash to the pot.",
                        "Pour in vegetable broth and bring to a boil.",
                        "Reduce heat and simmer for 15 minutes.",
                        "Use an immersion blender or transfer to a regular blender to puree until smooth.",
                        "Stir in heavy cream if using and season with nutmeg, salt, and pepper to taste.",
                        "Serve hot with a drizzle of cream or a sprinkle of herbs."
                    ],
                    category: "soups",
                    cuisine: "american",
                    difficulty: "medium"
                },
                {
                    name: "Butternut Squash Soup",
                    requires: ["squash"],
                    ingredients: [
                        {item: "butternut squash", amount: 1, unit: "large", notes: "peeled, seeded, and cubed"},
                        {item: "onion", amount: 1, unit: "medium", notes: "chopped"},
                        {item: "carrots", amount: 2, unit: "medium", notes: "chopped"},
                        {item: "garlic", amount: 3, unit: "cloves", notes: "minced"},
                        {item: "vegetable broth", amount: 4, unit: "cups", notes: ""},
                        {item: "olive oil", amount: 2, unit: "tablespoons", notes: ""},
                        {item: "sage", amount: 1, unit: "teaspoon", notes: "dried, or 2 tbsp fresh"},
                        {item: "salt", amount: 1, unit: "teaspoon", notes: "to taste"},
                        {item: "black pepper", amount: 0.5, unit: "teaspoon", notes: "to taste"},
                        {item: "coconut milk", amount: 0.5, unit: "cup", notes: "optional, for creaminess"}
                    ],
                    instructions: [
                        "Heat olive oil in a large pot over medium heat.",
                        "Add onion and carrots, cook for 5 minutes until softened.",
                        "Add garlic and sage, cook for 30 seconds until fragrant.",
                        "Add squash cubes and vegetable broth.",
                        "Bring to a boil, then reduce heat and simmer for 20-25 minutes until squash is tender.",
                        "Use an immersion blender to puree until smooth.",
                        "Stir in coconut milk if using and season with salt and pepper.",
                        "Serve hot with a garnish of fresh sage or a drizzle of olive oil."
                    ],
                    category: "soups",
                    cuisine: "american",
                    difficulty: "easy"
                },
                {
                    name: "Creamy Tomato Soup",
                    requires: ["tomato", "tomato sauce"],
                    ingredients: [
                        {item: "tomatoes", amount: 6, unit: "large", notes: "or 2 cans crushed tomatoes"},
                        {item: "tomato sauce", amount: 1, unit: "cup", notes: "or marinara sauce"},
                        {item: "onion", amount: 1, unit: "medium", notes: "chopped"},
                        {item: "garlic", amount: 3, unit: "cloves", notes: "minced"},
                        {item: "vegetable broth", amount: 2, unit: "cups", notes: ""},
                        {item: "heavy cream", amount: 0.5, unit: "cup", notes: "or coconut cream"},
                        {item: "olive oil", amount: 2, unit: "tablespoons", notes: ""},
                        {item: "basil", amount: 0.25, unit: "cup", notes: "fresh, chopped"},
                        {item: "salt", amount: 1, unit: "teaspoon", notes: "to taste"},
                        {item: "black pepper", amount: 0.5, unit: "teaspoon", notes: "to taste"}
                    ],
                    instructions: [
                        "Heat olive oil in a large pot over medium heat.",
                        "Add chopped onion and cook for 5 minutes until softened.",
                        "Add minced garlic and cook for 30 seconds until fragrant.",
                        "Add tomatoes, tomato sauce, and vegetable broth.",
                        "Bring to a boil, then reduce heat and simmer for 20 minutes.",
                        "Use an immersion blender to puree until smooth.",
                        "Stir in heavy cream and fresh basil.",
                        "Season with salt and pepper to taste.",
                        "Serve hot with a garnish of fresh basil and a drizzle of cream."
                    ],
                    category: "soups",
                    cuisine: "italian",
                    difficulty: "easy"
                },
                {
                    name: "Chicken Noodle Soup",
                    requires: ["chicken", "noodles"],
                    ingredients: [
                        {item: "chicken breast", amount: 1, unit: "pound", notes: "cubed"},
                        {item: "egg noodles", amount: 8, unit: "ounces", notes: "or pasta of choice"},
                        {item: "carrots", amount: 3, unit: "medium", notes: "sliced"},
                        {item: "celery", amount: 3, unit: "stalks", notes: "sliced"},
                        {item: "onion", amount: 1, unit: "medium", notes: "chopped"},
                        {item: "garlic", amount: 3, unit: "cloves", notes: "minced"},
                        {item: "chicken broth", amount: 6, unit: "cups", notes: ""},
                        {item: "olive oil", amount: 2, unit: "tablespoons", notes: ""},
                        {item: "thyme", amount: 1, unit: "teaspoon", notes: "dried"},
                        {item: "salt", amount: 1, unit: "teaspoon", notes: "to taste"},
                        {item: "black pepper", amount: 0.5, unit: "teaspoon", notes: "to taste"}
                    ],
                    instructions: [
                        "Heat olive oil in a large pot over medium heat.",
                        "Add chicken and cook for 5-7 minutes until browned. Remove and set aside.",
                        "Add onion, carrots, and celery to the pot. Cook for 5 minutes until softened.",
                        "Add garlic and thyme, cook for 30 seconds until fragrant.",
                        "Pour in chicken broth and bring to a boil.",
                        "Add noodles and cook according to package directions.",
                        "Return chicken to the pot and simmer for 5 minutes.",
                        "Season with salt and pepper to taste.",
                        "Serve hot with fresh herbs if desired."
                    ],
                    category: "soups",
                    cuisine: "american",
                    difficulty: "easy"
                },
                {
                    name: "Minestrone Soup",
                    requires: ["vegetables", "pasta"],
                    ingredients: [
                        {item: "mixed vegetables", amount: 3, unit: "cups", notes: "carrots, celery, zucchini, spinach"},
                        {item: "pasta", amount: 1, unit: "cup", notes: "small pasta like ditalini or elbow macaroni"},
                        {item: "cannellini beans", amount: 1, unit: "can", notes: "15 oz, drained and rinsed"},
                        {item: "tomato sauce", amount: 1, unit: "cup", notes: ""},
                        {item: "vegetable broth", amount: 4, unit: "cups", notes: ""},
                        {item: "onion", amount: 1, unit: "medium", notes: "chopped"},
                        {item: "garlic", amount: 3, unit: "cloves", notes: "minced"},
                        {item: "olive oil", amount: 2, unit: "tablespoons", notes: ""},
                        {item: "italian seasoning", amount: 1, unit: "teaspoon", notes: ""},
                        {item: "parmesan cheese", amount: 0.25, unit: "cup", notes: "freshly grated"},
                        {item: "salt", amount: 1, unit: "teaspoon", notes: "to taste"},
                        {item: "black pepper", amount: 0.5, unit: "teaspoon", notes: "to taste"}
                    ],
                    instructions: [
                        "Heat olive oil in a large pot over medium heat.",
                        "Add onion and cook for 5 minutes until softened.",
                        "Add garlic and Italian seasoning, cook for 30 seconds until fragrant.",
                        "Add vegetables and cook for 3-5 minutes until slightly softened.",
                        "Pour in vegetable broth and tomato sauce. Bring to a boil.",
                        "Add pasta and cook according to package directions.",
                        "Stir in beans and simmer for 5 minutes.",
                        "Season with salt and pepper to taste.",
                        "Serve hot with freshly grated parmesan cheese."
                    ],
                    category: "soups",
                    cuisine: "italian",
                    difficulty: "medium"
                }
            ];

            // Find the best matching template
            let bestMatch = null;
            let bestScore = 0;

            for (const template of recipeTemplates) {
                const matchingIngredients = template.requires.filter(req => 
                    ingredientsLower.some(ing => {
                        // Direct match
                        if (ing.includes(req) || req.includes(ing)) return true;
                        
                        // Word-based matching
                        const ingWords = ing.split(' ');
                        const reqWords = req.split(' ');
                        
                        // Check if any word in the ingredient matches any word in the requirement
                        return ingWords.some(ingWord => 
                            reqWords.some(reqWord => 
                                ingWord.includes(reqWord) || reqWord.includes(ingWord)
                            )
                        );
                    })
                );
                
                const score = matchingIngredients.length / template.requires.length;
                
                // Bonus points for category match
                let categoryBonus = 0;
                if (selectedCategories.length > 0 && selectedCategories.includes(template.category)) {
                    categoryBonus = 0.3;
                }
                
                // Bonus points for cuisine match
                let cuisineBonus = 0;
                if (selectedCuisines.length > 0 && selectedCuisines.includes(template.cuisine)) {
                    cuisineBonus = 0.2;
                }
                
                const totalScore = score + categoryBonus + cuisineBonus;
                
                if (totalScore > bestScore && score >= 0.3) { // Lowered threshold for better matching
                    bestScore = totalScore;
                    bestMatch = template;
                }
            }

            if (bestMatch) {
                // Use the template and adapt it to available ingredients
                const recipe = {
                    name: bestMatch.name,
                    ingredients: bestMatch.ingredients,
                    instructions: bestMatch.instructions,
                    prep_time: 15,
                    cook_time: 20,
                    total_time: 35,
                    servings: 2,
                    difficulty: bestMatch.difficulty,
                    cuisine: bestMatch.cuisine,
                    category: bestMatch.category,
                    tags: ["quick", "easy", "ingredient-based"],
                    dietary: selectedDietary.length > 0 ? selectedDietary : []
                };

                // Adapt ingredients based on what user actually has
                recipe.ingredients = recipe.ingredients.map(ing => {
                    const userHas = ingredientsLower.some(userIng => 
                        ing.item.toLowerCase().includes(userIng) || 
                        userIng.includes(ing.item.toLowerCase())
                    );
                    
                    if (userHas) {
                        return { ...ing, notes: ing.notes + " (you have this)" };
                    }
                    return ing;
                });

                return recipe;
            }

            // Fallback: Create a simple recipe with available ingredients
            return {
                name: `Simple ${ingredients.slice(0, 3).join(' ')} Dish`,
                ingredients: [
                    ...ingredients.map(ing => ({item: ing, amount: 1, unit: "cup", notes: "as needed"})),
                    {item: "olive oil", amount: 2, unit: "tablespoons", notes: "for cooking"},
                    {item: "garlic", amount: 2, unit: "cloves", notes: "minced (if not already included)"},
                    {item: "salt", amount: 1, unit: "teaspoon", notes: "to taste"},
                    {item: "black pepper", amount: 1, unit: "teaspoon", notes: "to taste"}
                ],
                instructions: [
                    "Heat olive oil in a large skillet over medium heat.",
                    "Add minced garlic and cook for 30 seconds until fragrant.",
                    `Add ${ingredients.slice(0, 3).join(', ')} and cook for 5-7 minutes until heated through.`,
                    "Season with salt and black pepper to taste.",
                    "Serve immediately while hot."
                ],
                prep_time: 10,
                cook_time: 10,
                total_time: 20,
                servings: 4,
                difficulty: "easy",
                cuisine: "general",
                category: selectedCategories[0] || "dinner",
                tags: ["quick", "simple", "ingredient-based"],
                dietary: selectedDietary.length > 0 ? selectedDietary : []
            };
        }

        function getRandomRecipe() {
            showLoading();
            
            setTimeout(() => {
                const ingredientsInput = document.getElementById('ingredients').value.trim();
                let availableRecipes = RECIPE_DATABASE;
                
                // If user has entered ingredients, only show recipes that contain them
                if (ingredientsInput) {
                    const userIngredients = ingredientsInput.split(',').map(ing => ing.trim());
                    const userIngredientsLower = userIngredients.map(ing => ing.toLowerCase());
                    
                    availableRecipes = availableRecipes.filter(recipe => {
                        const recipeIngredients = recipe.ingredients.map(ing => ing.item.toLowerCase());
                        return userIngredientsLower.some(userIng => 
                            recipeIngredients.some(recipeIng => 
                                recipeIng.includes(userIng) || userIng.includes(recipeIng)
                            )
                        );
                    });
                    
                    // If no existing recipes match, generate a new one
                    if (availableRecipes.length === 0) {
                        currentRecipe = generateNewRecipeFromIngredients(userIngredients);
                        const formatted = formatRecipe(currentRecipe);
                        displayRecipe(formatted);
                        hideLoading();
                        return;
                    }
                }
                
                // Apply filters if any are selected
                if (selectedCategories.length > 0 || selectedDietary.length > 0 || selectedCuisines.length > 0) {
                    availableRecipes = filterRecipesBySelections(availableRecipes);
                }
                
                if (availableRecipes.length === 0) {
                    alert('No recipes match your selected filters and ingredients. Try clearing the filters or entering different ingredients.');
                    hideLoading();
                    return;
                }
                
                const randomIndex = Math.floor(Math.random() * availableRecipes.length);
                currentRecipe = availableRecipes[randomIndex];
                const formatted = formatRecipe(currentRecipe);
                displayRecipe(formatted);
                hideLoading();
            }, 1000);
        }

        function displayRecipe(formatted) {
            document.getElementById('recipeDisplay').textContent = formatted;
            document.getElementById('recipeDisplay').classList.remove('hidden');
            document.getElementById('aiRemixSection').style.display = 'block';
            updateFavoriteIcon();
        }

        function aiRemixRecipe() {
            if (!currentRecipe) {
                alert('Please generate a recipe first!');
                return;
            }

            showLoading();
            
            setTimeout(() => {
                // AI Remix Logic - Create realistic variations
                const remixVariations = [
                    {
                        name: `Spicy ${currentRecipe.name}`,
                        additions: [
                            {item: "red pepper flakes", amount: 0.5, unit: "teaspoon", notes: "or to taste"},
                            {item: "cayenne pepper", amount: 0.25, unit: "teaspoon", notes: "optional"},
                            {item: "jalape√±o", amount: 1, unit: "medium", notes: "minced, seeds removed"}
                        ],
                        instructions: [
                            "Add red pepper flakes and cayenne pepper for extra heat.",
                            "Saut√© jalape√±o with other aromatics for a spicy kick."
                        ]
                    },
                    {
                        name: `Creamy ${currentRecipe.name}`,
                        additions: [
                            {item: "heavy cream", amount: 0.5, unit: "cup", notes: "or coconut cream for dairy-free"},
                            {item: "cream cheese", amount: 2, unit: "ounces", notes: "softened"},
                            {item: "parmesan cheese", amount: 0.25, unit: "cup", notes: "freshly grated"}
                        ],
                        instructions: [
                            "Stir in heavy cream and cream cheese for a rich, creamy texture.",
                            "Finish with freshly grated parmesan cheese."
                        ]
                    },
                    {
                        name: `Mediterranean ${currentRecipe.name}`,
                        additions: [
                            {item: "kalamata olives", amount: 0.5, unit: "cup", notes: "pitted and chopped"},
                            {item: "sun-dried tomatoes", amount: 0.25, unit: "cup", notes: "chopped"},
                            {item: "feta cheese", amount: 0.5, unit: "cup", notes: "crumbled"},
                            {item: "oregano", amount: 1, unit: "teaspoon", notes: "dried"}
                        ],
                        instructions: [
                            "Add Mediterranean flavors with olives, sun-dried tomatoes, and feta.",
                            "Season with oregano for authentic Mediterranean taste."
                        ]
                    },
                    {
                        name: `Asian Fusion ${currentRecipe.name}`,
                        additions: [
                            {item: "soy sauce", amount: 2, unit: "tablespoons", notes: "low sodium"},
                            {item: "sesame oil", amount: 1, unit: "tablespoon", notes: "toasted"},
                            {item: "ginger", amount: 1, unit: "tablespoon", notes: "fresh, grated"},
                            {item: "green onions", amount: 3, unit: "stalks", notes: "chopped"}
                        ],
                        instructions: [
                            "Add Asian flavors with soy sauce, sesame oil, and fresh ginger.",
                            "Garnish with chopped green onions for authentic Asian touch."
                        ]
                    },
                    {
                        name: `Herb Garden ${currentRecipe.name}`,
                        additions: [
                            {item: "fresh basil", amount: 0.5, unit: "cup", notes: "chopped"},
                            {item: "fresh parsley", amount: 0.25, unit: "cup", notes: "chopped"},
                            {item: "fresh thyme", amount: 2, unit: "sprigs", notes: "leaves removed"},
                            {item: "lemon zest", amount: 1, unit: "tablespoon", notes: "freshly grated"}
                        ],
                        instructions: [
                            "Enhance with fresh herbs from the garden.",
                            "Add lemon zest for bright, fresh flavor."
                        ]
                    }
                ];

                // Randomly select a variation
                const variation = remixVariations[Math.floor(Math.random() * remixVariations.length)];
                
                const remixedRecipe = {
                    ...currentRecipe,
                    name: variation.name,
                    ingredients: [
                        ...currentRecipe.ingredients,
                        ...variation.additions
                    ],
                    instructions: [
                        ...currentRecipe.instructions,
                        ...variation.instructions
                    ],
                    prep_time: currentRecipe.prep_time + 5,
                    cook_time: currentRecipe.cook_time + 5,
                    total_time: currentRecipe.total_time + 10,
                    tags: [...(currentRecipe.tags || []), "AI-remixed", "variation"]
                };
                
                currentRecipe = remixedRecipe;
                const formatted = formatRecipe(remixedRecipe);
                displayRecipe(formatted);
                hideLoading();
            }, 1500);
        }

        // Allow Enter key to submit
        document.getElementById('ingredients').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generateRecipe();
            }
        });

        // Action Bar Functionality
        document.getElementById('conversionChartBtn').onclick = function() {
            document.getElementById('conversionChartModal').classList.remove('hidden');
        };
        document.getElementById('closeConversionChart').onclick = function() {
            document.getElementById('conversionChartModal').classList.add('hidden');
        };
        window.onclick = function(event) {
            if (event.target === document.getElementById('conversionChartModal')) {
                document.getElementById('conversionChartModal').classList.add('hidden');
            }
        };

        // Save, Favorite, Share handlers
        document.getElementById('saveBtn').onclick = function() {
            if (!currentRecipe) {
                alert('Please generate a recipe first!');
                return;
            }
            let savedRecipes = JSON.parse(localStorage.getItem('savedRecipes') || '[]');
            savedRecipes.push(currentRecipe);
            localStorage.setItem('savedRecipes', JSON.stringify(savedRecipes));
            alert('Recipe saved!');
        };

        document.getElementById('favoriteBtn').onclick = function() {
            if (!currentRecipe) {
                alert('Please generate a recipe first!');
                return;
            }
            let favorites = JSON.parse(localStorage.getItem('favoriteRecipes') || '[]');
            const idx = favorites.findIndex(r => r.name === currentRecipe.name);
            if (idx === -1) {
                favorites.push(currentRecipe);
                document.getElementById('favoriteIcon').textContent = '‚ù§Ô∏è';
                alert('Added to favorites!');
            } else {
                favorites.splice(idx, 1);
                document.getElementById('favoriteIcon').textContent = 'ü§ç';
                alert('Removed from favorites.');
            }
            localStorage.setItem('favoriteRecipes', JSON.stringify(favorites));
        };

        function updateFavoriteIcon() {
            if (!currentRecipe) {
                document.getElementById('favoriteIcon').textContent = 'ü§ç';
                return;
            }
            let favorites = JSON.parse(localStorage.getItem('favoriteRecipes') || '[]');
            const idx = favorites.findIndex(r => r.name === currentRecipe.name);
            document.getElementById('favoriteIcon').textContent = idx === -1 ? 'ü§ç' : '‚ù§Ô∏è';
        }

        document.getElementById('shareBtn').onclick = function() {
            if (!currentRecipe) {
                alert('Please generate a recipe first!');
                return;
            }
            const text = formatRecipe(currentRecipe);
            if (navigator.share) {
                navigator.share({
                    title: currentRecipe.name,
                    text: text
                }).catch(() => {
                    alert('Share cancelled or failed.');
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Recipe copied to clipboard!');
                }, () => {
                    alert('Could not copy to clipboard.');
                });
            }
        };
    </script>
</body>
</html> 